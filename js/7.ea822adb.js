(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{5992:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{id:"mypage"}},[a("q-layout-container",[a("div",{staticClass:"row justify-around",staticStyle:{padding:"100px 0"}},[a("div",{staticClass:"col-12 col-md-3 flex column mypage_line"},[a("div",{staticClass:"flex flex-center user_des"},[a("q-avatar",{staticClass:"img",attrs:{size:"120px"}},[a("img",{attrs:{src:o("d9fc")}})]),a("div",{staticClass:"flex user"},[a("p",{staticClass:"title"},[t._v(t._s(t.user.name))]),a("p",{staticClass:"account"},[t._v("@"+t._s(t.user.account))])])],1),a("div",{staticClass:"flex flex-center mypage_btnG"},[a("q-btn",{staticClass:"mypage_btn",attrs:{flat:"",rounded:"",color:"primary",icon:"add_circle_outline",size:"16px"},on:{click:function(e){t.uploadphoto=!0}}},[a("div",{staticClass:"btn_title"},[t._v("上傳照片")])]),a("q-btn",{staticClass:"mypage_btn",attrs:{flat:"",rounded:"",color:"primary",icon:"settings",size:"16px"},on:{click:function(e){t.editMenu=!t.editMenu}}},[a("div",{staticClass:"btn_title"},[t._v("編輯照片")])]),a("q-btn",{staticClass:"mypage_btn",attrs:{flat:"",rounded:"",color:"primary",icon:"star",size:"16px",to:{name:"front.space"}}},[a("div",{staticClass:"btn_title"},[t._v("療癒空間")])]),a("q-btn",{staticClass:"mypage_btn",attrs:{flat:"",rounded:"",color:"primary",icon:"pets",size:"16px",to:{name:"front.petpage"}}},[a("div",{staticClass:"btn_title"},[t._v("我的寶貝")])])],1)]),a("div",{staticClass:"col-12 col-md-8"},[a("container",{staticClass:"flex flex-center"},[a("div",{staticClass:"row fit wrap items-start"},t._l(t.photos,(function(e,o){return a("div",{key:e.file,staticClass:"col-6 col-md-4 col-lg-4 col-xl-3 q-pa-sm",attrs:{value:e}},[a("q-btn",{on:{click:function(o){return t.photoOpen(e)}}},[a("q-card",{staticClass:"my-pet-card"},[a("img",{attrs:{src:e.src}}),a("div",{staticClass:"absolute-bottom-right"})])],1),a("div",{staticClass:"q-pa-md",staticStyle:{"max-width":"300px"}},[e.edit?a("q-input",{attrs:{filled:"",type:"textarea"},model:{value:e.model,callback:function(o){t.$set(e,"model",o)},expression:"photo.model"}}):t._e()],1),t.editMenu?a("div",{staticStyle:{cursor:"pointer"}},[e.edit?t._e():a("q-icon",{attrs:{name:"create",color:"primary",size:"2rem"},on:{click:function(o){return t.edit(e)}}}),e.edit?t._e():a("q-icon",{attrs:{name:"delete_forever",color:"negative",size:"2rem"},on:{click:function(a){return t.dele(e,o)}}}),e.edit?a("q-icon",{attrs:{name:"save",color:"secondary",size:"2rem"},on:{click:function(o){return t.save(e)}}}):t._e(),e.edit?a("q-icon",{attrs:{name:"cancel",color:"accent",size:"2rem"},on:{click:function(o){return t.cancel(e)}}}):t._e()],1):t._e()],1)})),0)])],1)]),a("q-dialog",{model:{value:t.uploadphoto,callback:function(e){t.uploadphoto=e},expression:"uploadphoto"}},[a("q-card",{staticClass:"flex row",attrs:{id:"upload_dialog"}},[a("div",{staticClass:"col-12 flex flex-center",staticStyle:{background:"#56C6BF",height:"20%"}},[a("div",{staticClass:"flex justify-end",staticStyle:{width:"100%"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:"",color:"white"}})],1),a("p",{staticClass:"upload_title"},[t._v("上傳照片")])]),a("div",{staticClass:"col-12 flex flex-center cloumn",staticStyle:{height:"80%"}},[a("q-form",{staticStyle:{width:"80%"},on:{submit:t.onSubmit_upload,reset:t.onReset_upload}},[a("q-file",{staticStyle:{"margin-bottom":"1rem"},attrs:{filled:"","bottom-slots":"",counter:"",label:"選擇檔案",color:"secondary"},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){e.stopPropagation(),t.model=null}}})]},proxy:!0},{key:"hint",fn:function(){return[t._v("\n                *僅接受jpeg、png格式，且檔案不超過1MB\n              ")]},proxy:!0}]),model:{value:t.photoFile,callback:function(e){t.photoFile=e},expression:"photoFile"}}),a("div",{staticClass:"flex row justify-between",staticStyle:{"margin-bottom":"1rem"}},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.animalSelected,expression:"animalSelected"}],staticClass:"col-12 col-lg-5 ULanimaltype",attrs:{placeholder:"選擇動物類型"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.animalSelected=e.target.multiple?o:o[0]}}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("選擇你的動物種類")]),t._l(t.animals,(function(e){return a("option",{key:e.name,domProps:{value:e}},[t._v(t._s(e.name))])}))],2),a("select",{directives:[{name:"model",rawName:"v-model",value:t.breedSelected,expression:"breedSelected"}],staticClass:"col-12 col-lg-6 ULanimaltype",attrs:{placeholder:"選擇你的動物品種"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.breedSelected=e.target.multiple?o:o[0]}}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("選擇你的動物品種")]),t._l(t.selectedBreed,(function(e){return a("option",{key:e.name,domProps:{value:e}},[t._v(t._s(e.name))])}))],2)]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.bodySelected,expression:"bodySelected"}],staticClass:"col-12 ULanimaltype_bp",attrs:{placeholder:"選擇你的動物部位"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.bodySelected=e.target.multiple?o:o[0]}}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v("選擇相片的重點")]),t._l(t.selectedBodypart,(function(e){return a("option",{key:e.name,domProps:{value:e}},[t._v(t._s(e.name))])}))],2),a("q-input",{attrs:{filled:"",clearable:"",type:"textarea",color:"secondary",label:"說明文字",hint:"*說明限50字內"},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}}),a("div",{staticClass:"login-btn flex flex-center"},[a("q-btn",{staticStyle:{"margin-right":"1rem",width:"80px"},attrs:{rounded:"",label:"上傳",type:"submit",color:"secondary",size:"1.1rem"}}),a("q-btn",{staticStyle:{width:"80px"},attrs:{rounded:"",label:"重置",type:"reset",color:"accent",size:"1.1rem"}})],1)],1)],1)])],1),a("q-dialog",{model:{value:t.photoOpenn,callback:function(e){t.photoOpenn=e},expression:"photoOpenn"}},[a("q-card",{staticClass:"column pet_card"},[a("q-card-section",{staticClass:"row justify-end q-pb-none"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",round:"",dense:"",color:"primary"}})],1),a("q-card-section",{staticClass:"photoBox"},[a("img",{staticClass:"photo",attrs:{src:t.photoopen.src}})]),a("q-card-section",[a("div",[a("q-chip",{attrs:{color:"primary","text-color":"white"}},[t._v("\n              "+t._s(t.photoopen.animal)+"\n            ")]),a("q-chip",{attrs:{color:"accent","text-color":"white"}},[t._v("\n              "+t._s(t.photoopen.breed)+"\n            ")])],1)]),a("q-card-section",{staticStyle:{margin:"0 0 1rem 0.5rem"}},[a("div",[t._v("\n            "+t._s(t.photoopen.description)+"\n          ")])])],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.delOK,callback:function(e){t.delOK=e},expression:"delOK"}},[a("q-card",{staticClass:"text-white bg-red-10",staticStyle:{width:"350px"}},[a("q-card-section",{staticClass:"flex flex-center"},[a("div",{staticClass:"text-h5"},[t._v("刪除通知")])]),a("q-card-section",{staticClass:"q-pt-none flex flex-center"},[t._v("\n          你確定要刪除這張照片嗎?\n        ")]),a("q-card-actions",{staticClass:"bg-white text-red-10 flex flex-center",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"刪除"},on:{click:function(e){return t.del(t.delePho,t.idx)}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}})],1)],1)],1)],1)],1)},s=[],i=(o("e01a"),o("a434"),o("e6cf"),{name:"Mypage",data(){return{uploadphoto:!1,photoFile:"",animalSelected:"",breedSelected:"",bodySelected:"",textarea:"",animals:[],photos:[],updateSuccess:!1,editMenu:!1,uploadSuccess:!1,photoopen:{},photoOpenn:!1,delOK:!1,delePho:"",idx:""}},computed:{user(){return this.$store.state.user},selectedBreed(){return this.animalSelected.breeds},selectedBodypart(){return this.animalSelected.bodypart}},methods:{onSubmit_upload(){if(this.photoFile.size>1048576)this.$swal.fire({icon:"error",title:"錯誤",text:"圖片太大",confirmButtonColor:"#C2B593",iconColor:"#8d2430"});else if(0===this.photoFile.length)this.$swal.fire({icon:"error",title:"錯誤",text:"圖片欄位不得空白",confirmButtonColor:"#C2B593",iconColor:"#8d2430"});else if(this.photoFile.type.includes("image"))if(0===this.animalSelected.length)this.$swal.fire({icon:"error",title:"錯誤",text:"請選擇動物分類",confirmButtonColor:"#C2B593",iconColor:"#8d2430"});else if(0===this.breedSelected.length)this.$swal.fire({icon:"error",title:"錯誤",text:"請選擇動物品種",confirmButtonColor:"#C2B593",iconColor:"#8d2430"});else if(0===this.bodySelected.length)this.$swal.fire({icon:"error",title:"錯誤",text:"請選擇相片重點",confirmButtonColor:"#C2B593",iconColor:"#8d2430"});else{const t=new FormData;t.append("image",this.photoFile),t.append("animal",this.animalSelected._id),t.append("breed",this.breedSelected._id),t.append("bodypart",this.bodySelected._id),t.append("description",this.textarea),this.axios.post("https://petcle.herokuapp.com/photos/",t).then((async t=>{if(console.log(t.data),t.data.success){t.data.result.src="https://petcle.herokuapp.com/photos/file/"+t.data.result.file,t.data.result.title=t.data.result.description,t.data.result.model=t.data.result.description,t.data.result.animal01=t.data.result.animal,t.data.result.breeds01=t.data.result.breeds,t.data.result.bodyparts01=t.data.result.bodyparts,t.data.result.edit=!1;const e=t.data.result;let o=await this.axios.get("https://petcle.herokuapp.com/photos/breeds/"+e._id);e.breed=o.data.breed.name,o=await this.axios.get("https://petcle.herokuapp.com/photos/bodyparts/"+e._id),e.bodypart=o.data.body.name,o=await this.axios.get("https://petcle.herokuapp.com/photos/animals/"+e._id),e.animal=o.data.animal,this.photos.push(e),this.$swal.fire({icon:"success",title:"上傳成功",confirmButtonColor:"#C2B593",iconColor:"#56C6BF"}),this.uploadphoto=!1,this.photoFile=null,this.animalSelected="",this.breedSelected="",this.bodySelected="",this.textarea=""}else this.$swal.fire({icon:"error",title:"錯誤",confirmButtonColor:"#C2B593",iconColor:"#8d2430"})}))}else this.$swal.fire({icon:"error",title:"錯誤",text:"圖片格式錯誤",confirmButtonColor:"#C2B593",iconColor:"#8d2430"})},onReset_upload(){this.photoFile=null,this.animalSelected="",this.breedSelected="",this.bodySelected="",this.textarea=""},cancel(t){t.edit=!1,t.model=t.des},save(t){this.axios.patch("https://petcle.herokuapp.com/photos/"+t._id,{description:t.model}).then((e=>{e.data.success?(t.edit=!1,t.des=t.model,this.$swal.fire({icon:"success",title:"更新成功",confirmButtonColor:"#C2B593",iconColor:"#56C6BF"})):this.$swal.fire({icon:"error",title:"錯誤",text:"儲存失敗",confirmButtonColor:"#C2B593",iconColor:"#8d2430",border:"none"})})).catch((t=>{console.log(t)}))},edit(t){t.edit=!0,t.model=t.description},dele(t,e){this.delOK=!0,this.delePho=t,this.idx=e},del(t,e){this.axios.delete("https://petcle.herokuapp.com/photos/"+t._id).then((t=>{t.data.success?(this.photos.splice(e,1),this.$swal.fire({icon:"success",title:"刪除成功",confirmButtonColor:"#C2B593",iconColor:"#56C6BF"}),this.delOK=!1):this.$swal.fire({icon:"error",title:"錯誤",text:"刪除失敗",confirmButtonColor:"#C2B593",iconColor:"#8d2430",border:"none"})})).catch((t=>{console.log(t)}))},photoOpen(t){this.photoOpenn=!0,this.photoopen=t}},async mounted(){this.axios.get("https://petcle.herokuapp.com/animals/").then((t=>{t.data.success?this.animals=t.data.result:this.$swal.fire({icon:"error",title:"錯誤",confirmButtonColor:"#C2B593",iconColor:"#8d2430"})})).catch((t=>{console.log(t)})),await this.axios.get("https://petcle.herokuapp.com/photos/user/"+this.user.id).then((t=>{t.data.success?this.photos=t.data.result.map((t=>(t.src="https://petcle.herokuapp.com/photos/file/"+t.file,t.des=t.description,t.model=t.description,t.breed=t.breeds,t.bodypart=t.bodyparts,t.edit=!1,delete t.breeds,delete t.bodyparts,t))):this.$swal.fire({icon:"error",title:"錯誤",confirmButtonColor:"#C2B593",iconColor:"#8d2430"})})).catch((t=>{console.log(t)})),this.photos.map((async t=>{try{let e=await this.axios.get("https://petcle.herokuapp.com/photos/breeds/"+t._id);t.breed=e.data.breed.name,e=await this.axios.get("https://petcle.herokuapp.com/photos/bodyparts/"+t._id),t.bodypart=e.data.body.name,e=await this.axios.get("https://petcle.herokuapp.com/photos/animals/"+t._id),t.animal=e.data.animal}catch(e){console.log(e)}return t}))}}),l=i,r=o("2877"),n=o("9989"),c=o("4d5a"),d=o("cb32"),p=o("9c40"),u=o("f09f"),h=o("27f9"),m=o("0016"),f=o("24e8"),b=o("0378"),v=o("7d53"),C=o("a370"),y=o("b047"),x=o("4b7e"),_=o("7f67"),g=o("eebe"),w=o.n(g),S=Object(r["a"])(l,a,s,!1,null,null,null);e["default"]=S.exports;w()(S,"components",{QPage:n["a"],QLayout:c["a"],QAvatar:d["a"],QBtn:p["a"],QCard:u["a"],QInput:h["a"],QIcon:m["a"],QDialog:f["a"],QForm:b["a"],QFile:v["a"],QCardSection:C["a"],QChip:y["a"],QCardActions:x["a"]}),w()(S,"directives",{ClosePopup:_["a"]})},d9fc:function(t,e,o){t.exports=o.p+"img/userphoto-01.7a6dafa3.jpg"}}]);